# è¿æ¥ä¸ä¸ŠDocker-Kafka-brokeråŠKafkaè§£å†³å†…ç½‘å¤–ç½‘éš”ç¦»çš„å‡ ä¸ªé‡è¦å‚æ•°

# 1.èƒŒæ™¯

åƒä¹‹å‰çš„å¤§æ•°æ®ç¯å¢ƒç­‰éƒ½æ˜¯é€šè¿‡Dockeræ¥æ­å»ºçš„ï¼Œæ— è®ºæ˜¯åœ¨å­¦ä¹ ï¼Œæµ‹è¯•ï¼Œè¿ç§»æ—¶å€™æ— ç–‘æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯åœ¨å¤šä¸ªç¯å¢ƒä¸‹è¿˜æƒ³ä½¿ç”¨åŒä¸€å¥—ç¯å¢ƒæ—¶å€™,[https://github.com/hulichao/docker-bigdata](https://github.com/hulichao/docker-bigdata "https://github.com/hulichao/docker-bigdata"),æ­å»ºæ€è·¯ï¼Œå¯ä»¥å‚è€ƒæœ¬ä»“åº“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªè¦æ³¨æ„æ¯”è™šæ‹Ÿæœºè¦å¤šåšä¸ªç«¯å£æ˜ å°„ç­‰ï¼Œç«¯å£æ˜ å°„ä¹Ÿå³ç½‘ç»œæ–¹é¢ï¼Œå…¶å®æ˜¯ç›¸å¯¹å†—ä½™çš„ï¼Œæ‰€ä»¥åœ¨æ­å»ºkafkaçš„ç¯å¢ƒæ—¶å€™æ­£å¥½é‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾`connection to node 0 colud not be establised. Broker may not be avaliable`

![](image/image_bERu9eW3Sx.png)

kafkaè¿ä¸ä¸Šbrokerï¼Œåœ¨è™šæ‹Ÿæœºçš„æœºå™¨ä¸Šæ²¡é—®é¢˜ï¼Œä½†æ˜¯æœ¬åœ°ä½¿ç”¨ideaè¿æ¥æ˜¯æœ‰é—®é¢˜çš„ã€‚

# 2.æ€è·¯

æ˜¯äº‹åå†™çš„åšå®¢ï¼Œæ‰€ä»¥å½“æ—¶çš„ä¸€äº›æ’æŸ¥é—®é¢˜çš„æˆªå›¾ï¼Œä¸ä¸€ä¸€è´´å‡ºæ¥äº†ï¼Œåªç®€è¿°ä¸€ä¸‹è¿‡ç¨‹å’Œæœ€ç»ˆè§£å†³ï¼Œä»¥åŠå¼•å‡ºkafkaå¯¹å†…å¤–ç½‘éš”ç¦»æ—¶å€™çš„è§£å†³æ–¹å¼

## 2.1 é¦–å…ˆæ’æŸ¥å„ç§ç½‘ç»œé—®é¢˜

æ¯”å¦‚è™šæ‹Ÿæœºç½‘ç»œï¼Œä½¿ç”¨`ping www.baidu.com` å†æ£€æŸ¥ç«¯å£ä½¿ç”¨`telnet linux121 9092` å‘ç°éƒ½æ²¡æœ‰é—®é¢˜ï¼Œå¦å¤–æŸ¥äº†Dockerçš„è™šæ‹Ÿç½‘å¡ï¼Œå¯ä»¥å‚è€ƒå¦å¤–ä¸€ç¯‡æ–‡ç« ï¼Œ[https://blog.csdn.net/hu\_lichao/article/details/109538567](https://blog.csdn.net/hu_lichao/article/details/109538567 "https://blog.csdn.net/hu_lichao/article/details/109538567")ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰é—®é¢˜

## 2.2 ç„¶åå¼€å§‹è€ƒè™‘æ˜¯Kafkaçš„é—®é¢˜

æœ¬æ¥æ²¡æœ‰å¾€è¿™ä¸ªæ–¹å‘æƒ³ï¼Œæœ€ååªå¥½å€ŸåŠ©`google`, è¾“å…¥å…³é”®å­— `kafka docker idea è¿ä¸ä¸ŠBroker` ,å¦‚ä¸‹å›¾

![](image/image_julQ90B7Mj.png)

ç„¶åå‚è€ƒç¬¬ä¸€æ¡ï¼Œè¯»å–å…³é”®çš„ä¿¡æ¯ï¼š`Kafkaçš„å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç»Ÿç§°ï¼‰è¦è¿æ¥ Broker éœ€è¦ç»è¿‡ä¸€å±‚è®¤è¯ï¼Œä¸é€šè¿‡è®¤è¯å°±æ— æ³•è¿æ¥ï¼` ç„¶åç»§ç»­å¾€ä¸‹è¯»ï¼Œå®¢æˆ·ç«¯è¿æ¥Kafkaéœ€è¦ä¸¤å±‚è®¤è¯ï¼Œå…¶ä¸€æ˜¯Zkä¸Šçš„Brokerä¸­çš„`advertised.listeners` é…ç½®çš„è¿æ¥å’Œç«¯å£ï¼Œæ³¨æ„ï¼šè¿™é‡Œè¾ƒå‘çš„ä¸€ç‚¹å°±æ˜¯ï¼Œå¿…é¡»åŸæ ·æ¯”å¯¹   PLAINTEXT ä¸­çš„å†…å®¹è¦å’ŒJavaç¨‹åºä¸­çš„è¦å¯¹åº”ï¼Œå³ä¸è€ƒè™‘ä½ æ˜¯æ€ä¹ˆæ‹¿åˆ°è™šæ‹Ÿæœºä¸­çš„Dockerä¸­çš„kafkaçš„è¿æ¥ï¼Œæ€»ä¹‹ä½ è¦å‘é€çš„`bootstrap.servers` çš„å†…å®¹è¦å’Œ`PLAINTEXT` è¦ä¸€è‡´ï¼Œè¿™å°±éœ€è¦é…ç½®linux121 çš„hostsï¼Œæ˜ å°„åˆ°å®é™…çš„ipå’Œç«¯å£äº†ã€‚

> ğŸ“Œjavaä»£ç 

![](image/image_LQHymsIgUQ.png)

> ğŸ“Œzkè·å–brokerä¿¡æ¯

![](image/image_rB2ml9pxWI.png)

> ğŸ“Œkafkaçš„server.propertiesçš„é…ç½®

![](image/image_sHl8DJXcwZ.png)

# 3.Kafkaçš„å†…å¤–ç½‘å‚æ•°

æ ¹æ®å‰é¢çš„æ’æŸ¥é—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªé‡è¦å‚æ•°ï¼Œ`listeners`å’Œ`advertise.listeners` é‚£è¿™ä¸¤ä¸ªå‚æ•°æ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Œè¿™é‡Œæ‹¿æ¥å®˜æ–¹çš„ç¿»è¯‘ï¼Œ

> ç”¨äºæŒ‡å®šå½“å‰Brokerå‘å¤–å‘å¸ƒæœåŠ¡çš„åœ°å€å’Œç«¯å£ã€‚ä¸ advertised.listeners é…åˆï¼Œç”¨äºåšå†…å¤–ç½‘éš”ç¦»ã€‚

ä¸‹é¢ä»‹ç»å‡ ä¸ªç›¸å…³å‚æ•°ï¼š

`listener.security.protocol.map`

å†…å¤–ç½‘éš”ç¦»é…ç½®ï¼šç›‘å¬å™¨åç§°å’Œå®‰å…¨åè®®çš„æ˜ å°„é…ç½®ã€‚æ¯”å¦‚ï¼Œå¯ä»¥å°†å†…å¤–ç½‘éš”ç¦»ï¼Œå³ä½¿å®ƒä»¬éƒ½ä½¿ç”¨SSLã€‚`listener.security.protocol.map=INTERNAL:SSL,EXTERNAL:SSL` æ³¨æ„ï¼Œæ¯ä¸ªç›‘å¬å™¨çš„åç§°åªèƒ½åœ¨mapä¸­å‡ºç°ä¸€æ¬¡ã€‚
[inter.broker.listener.name](http://inter.broker.listener.name "inter.broker.listener.name")&#x20;

ç”¨äºé…ç½®brokerä¹‹é—´é€šä¿¡ä½¿ç”¨çš„ç›‘å¬å™¨åç§°ï¼Œè¯¥åç§°å¿…é¡»åœ¨`advertised.listeners`åˆ—è¡¨ä¸­ã€‚ä¾‹å¦‚`inter.broker.listener.name=EXTERNAL`
`listeners`

ç”¨äºé…ç½®brokerç›‘å¬çš„URIä»¥åŠç›‘å¬å™¨åç§°åˆ—è¡¨ï¼Œä½¿ç”¨é€—å·éš”å¼€å¤šä¸ªURIåŠç›‘å¬å™¨åç§°ã€‚
å¦‚æœç›‘å¬å™¨åç§°ä»£è¡¨çš„ä¸æ˜¯å®‰å…¨åè®®ï¼Œå¿…é¡»é…ç½®`listener.security.protocol.map`ã€‚
æ¯ä¸ªç›‘å¬å™¨å¿…é¡»ä½¿ç”¨ä¸åŒçš„ç½‘ç»œç«¯å£ã€‚
`advertised.listeners`
éœ€è¦å°†è¯¥åœ°å€å‘å¸ƒåˆ°zookeeperä¾›å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨çš„åœ°å€ä¸listenersé…ç½®ä¸åŒã€‚
å¯ä»¥åœ¨zookeeperçš„ `get /brokers/ids/<`[broker.id](http://broker.id "broker.id")`>` ä¸­æ‰¾åˆ°ã€‚

åœ¨IaaSç¯å¢ƒï¼Œè¯¥æ¡ç›®çš„ç½‘ç»œæ¥å£å¾—ä¸brokerç»‘å®šçš„ç½‘ç»œæ¥å£ä¸åŒã€‚
å¦‚æœä¸è®¾ç½®æ­¤æ¡ç›®ï¼Œå°±ä½¿ç”¨`listeners`çš„é…ç½®ã€‚è·Ÿlistenersä¸åŒï¼Œè¯¥æ¡ç›®ä¸èƒ½ä½¿ç”¨`0.0.0.0`ç½‘ç»œç«¯å£ã€‚
`advertised.listeners`çš„åœ°å€å¿…é¡»æ˜¯listenersä¸­é…ç½®çš„æˆ–é…ç½®çš„ä¸€éƒ¨åˆ†ã€‚

**æ³¨æ„**ï¼šINTERNAL å’Œ EXTERNALçš„ä½œç”¨å°±æ˜¯ç›¸å½“äºç»™PLAINTEXTåè®®èµ·äº†ä¸¤ä¸ªåˆ«åï¼Œé»˜è®¤mapä¸­åªèƒ½æœ‰ä¸€ä¸ªåŒåçš„åè®®ï¼Œæ•…åˆ†å¼€å†™

ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„å¸¸ç”¨é…ç½®ï¼š

![](image/image_pETE4PoPho.png)

ä»¥ä¸Šæ˜¯ä½¿ç”¨wolaiç¬”è®°å†™çš„ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘çš„é‚€è¯·ç `DJED4WI`è¿›è¡Œæ³¨å†Œå“Ÿï¼Œåé¢æœ‰é™ï¼Œæ¥æŠ¢å•¦ï¼

# 4.å‚è€ƒ

-   [https://www.cnblogs.com/hellxz/p/why\_cnnect\_to\_kafka\_always\_failure.html](https://www.cnblogs.com/hellxz/p/why_cnnect_to_kafka_always_failure.html "https://www.cnblogs.com/hellxz/p/why_cnnect_to_kafka_always_failure.html")

